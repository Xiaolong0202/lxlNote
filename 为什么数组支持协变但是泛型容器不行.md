#### 什么是协变？

在泛型或者数组的case下，协变其实指的是，基础类型具备父子关系，那么对应的容器类型也具备。





**数组的报错是在存元素时抛出的，而泛型的报错是在取元素是抛出的，这样，泛型的报错时机就非常延后了**，如果类型不对，压根就不应该让这个元素放入，否则，就只能在读取时进行强转才能发现，可别小看这个时机问题，一旦发生，非常难定位，很难查到是在哪里放入了类型异常的元素，所以泛型不允许协变。原因就是，类型转换的问题需要延后到读取时才能发现。而数组则可以在存入时就检测到类型不匹配的问题，从而fail-fast。

所以说数组是允许协变的，泛型不行。



## 为什么说是取元素的时候才会报错？

在 Java 中，泛型主要通过类型擦除来实现。类型擦除是指在编译时擦除泛型类型信息，使得在运行时泛型类型参数变为原始类型或者限定类型（bounded type）。这意味着编译器在生成字节码时会移除泛型类型信息，以保持与旧版本 Java 的兼容性。

当你向泛型集合中添加元素时，编译器会进行类型检查，并在编译时确保只有正确类型的元素被添加。因此，向泛型集合中添加元素时通常不会导致类型错误，因为编译器会确保添加的元素的类型符合泛型参数的要求。

然而，当你从泛型集合中取出元素时，由于类型擦除的存在，编译器无法确定集合中元素的具体类型。这时，编译器会生成一些隐式的类型转换代码，以将元素强制转换为你在代码中指定的类型。如果在运行时发现类型不匹配，就会抛出 `ClassCastException` 异常。

因此，泛型的错误通常在取元素时才会暴露出来。编译器能够在添加元素时进行类型检查，但在取元素时由于类型擦除，就需要在运行时进行类型转换，可能导致类型不匹配的问题。这也是为什么在使用泛型时，取元素的操作更容易导致运行时异常的原因。